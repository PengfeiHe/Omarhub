import tornado.web
import tornado.auth
from base import *
from core.db import *

class LoginAccessHandler(BaseHandler):
	def initialize(self):
		self.dbManager = dbmgr()
	def post(self):
		"""Check username & passwd"""
		passwd = self.get_arguments("u_passwd")
		usr_mail = self.get_arguments("u_mail")
		self.set_header("Content-Type", "text/plain")
			
		if not passwd:
			login_response = {
                		'error': True, 
                		'msg': 'Please enter your password .'
           		}
			self.write(login_response)
			return
		elif not usr_mail:
			login_response = {
                		'error': True, 
               			 'msg': 'Please enter your email address.'
           		 }
			self.write(login_response)
			return
		elif self.dbManager.checkAuth(unicode(usr_mail), unicode(passwd)):
			self.set_secure_cookie("user", usr_mail)
			self.redirect("/home")
			return
		else:
			login_response = {
                		'error': True, 
                		'msg': 'Wrong Password'
            		}
			self.write(login_response)
			return
